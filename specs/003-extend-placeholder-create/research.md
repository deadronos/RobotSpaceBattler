# Phase 0 Research — 3D Team Fight: extend-placeholder-create

This document captures research decisions and rationale for the feature. It resolves open "NEEDS CLARIFICATION" items from the plan template using the feature spec and repository conventions.

## Decision: Runtime platform and language

- Decision: Use TypeScript (existing repo is TypeScript + React) targeting ES2022 and the project's existing toolchain (Vite, Vitest).
- Rationale: The repository is already structured as a React + TypeScript web app; leveraging the existing toolchain minimizes infra changes and keeps the feature consistent with project conventions.
- Alternatives considered: Adding a separate backend service (rejected — out of scope and increases complexity).

## Decision: Synchronization strategy (Renderer <> Simulation)

- Decision: Hybrid model — simulation timestamps are the source of truth; renderer consumes MatchTrace and uses interpolation/extrapolation for smooth visuals. Support an optional frame-step debug mode.
- Rationale: Matches the spec clarifications and balances deterministic correctness with practical rendering smoothness.
- Alternatives: Tying playback strictly to renderer frames (rejected — breaks determinism), or strict timestamp-only playback without interpolation (rejected — poor UX when framerate is unstable).

## Decision: MatchTrace timing fields

- Decision: MatchTrace events will include `timestampMs` (integer ms since match start), optional `frameIndex` (integer), and `sequenceId` for stable ordering when timestamps tie. Trace-level metadata includes `rngSeed` and `rngAlgorithm`.
- Rationale: Matches spec clarifications; supports deterministic replay and cross-implementation warnings.

## Decision: Contract validation approach

- Decision: Implement FR-009-A as a TypeScript + JSON Schema validator using `ajv`, with Vitest tests located in `tests/contract-validator.spec.ts`. Provide `specs/003-extend-placeholder-create/schemas/team.schema.json` and `matchtrace.schema.json`.
- Rationale: Aligns with repo testing conventions and makes validation automatable in CI.

## Decision: Rendering quality profiles

- Decision: Provide named presets `High`, `Medium`, `Low` implemented as `VisualQualityProfile` objects that map to renderer parameters (shadow quality, particle density, texture LOD, post-processing toggles).
- Rationale: Allows runtime switching and automated tests to toggle profiles.

## Decision: Asset fallback and loader strategy

- Decision: Use r3f Suspense + loader abstraction for assets. On asset load failure, substitute a simple placeholder mesh/material and log an error to the dev console (guarded behind debug flags).
- Rationale: Follows constitution r3f best-practices and ensures renderer cannot crash the simulation.

## Open items / Risks

- Cross-browser WebGL behavior and GPU instancing nuances — mitigate by using Drei primitives and keeping instancing optional.
- Deterministic replay across different RNG implementations — include `rngAlgorithm` and fallback warnings when unsupported.

## Artifacts to produce (Phase 1)

- `specs/003-extend-placeholder-create/data-model.md` — canonical entities and field shapes
- `specs/003-extend-placeholder-create/schemas/team.schema.json`
- `specs/003-extend-placeholder-create/schemas/matchtrace.schema.json`
- `specs/003-extend-placeholder-create/quickstart.md` — how to run a demo match locally and run the contract validator

---

Generated by speckit.plan automated workflow on branch `003-extend-placeholder-create`.

